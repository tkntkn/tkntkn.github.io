<!DOCTYPE html>
<html>
<head>
  <title>tkntkn.github.io</title>
</head>
<body>
  <span id="message"></span>
  <script>
var messageElement = document.getElementById("message");
var say = message => messageElement.textContent = message;


const errorMessage = {
    0: "原因不明のエラーが発生しました…。" ,
    1: "位置情報の取得が許可されませんでした…。" ,
    2: "電波状況などで位置情報が取得できませんでした…。" ,
    3: "位置情報の取得に時間がかかり過ぎてタイムアウトしました…。" ,
} ;

var onError = error => say(errorMessage[error.code]);

var _geolocation, _geocode;
var onSuccess = async geolocation => {
    _geolocation = geolocation;
    const { latitude, longitude, accuracy } = geolocation.coords;
    say(`${new Date().toLocaleString()} ${latitude} ${longitude} ${accuracy}`);

    const url = `//maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&locale=ja`;
    const response = await (await fetch(url)).json();
    const address = response.results[0].formatted_address;
    _geocode = response;

    const ssu = new SpeechSynthesisUtterance();
    ssu.text = address.slice(13);
    ssu.lang = 'ja-JP';
    speechSynthesis.speak(ssu);
    console.log(geolocation);
};

var options = {
    enableHighAccuracy: true,
    timeout: 8000,
    maximumAge: 5000,
};

if (!navigator.geolocation) {
    say("位置情報が使えません");
} else {
    var watchId = navigator.geolocation.watchPosition(onSuccess, onError, options);
}

  </script>
</body>
</html>
